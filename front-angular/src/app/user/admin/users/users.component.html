<div class="users-container" 
     [class.mobile-layout]="isHandset$ | async"
    >
  <!-- Header Section -->
  <div class="header-section">
    <div class="header-content" >
      <div class="title-section">
        <h1 class="page-title">
          <mat-icon class="title-icon">people</mat-icon>
          Users Management
        </h1>
        <p class="page-subtitle">Manage and monitor all users in the system</p>
      </div>
    </div>
  </div>

  <!-- Filters Section -->
  <div class="filters-section">
    <div class="filters-card">
      <!-- Desktop Filters -->
      <ng-container *ngIf="!(isHandset$ | async); else mobileFilters">
        <div class="filters-grid">
          <div class="filter-group">
            <mat-form-field appearance="outline">
              <mat-label>Search by Name</mat-label>
              <input matInput placeholder="Search by name..." (input)="nameSearch($event)">
              <mat-icon matSuffix>person_search</mat-icon>
            </mat-form-field>
          </div>

          <div class="filter-group">
            <mat-form-field appearance="outline">
              <mat-label>Search by Email</mat-label>
              <input matInput placeholder="Search by email..." (input)="emailSearch($event)">
              <mat-icon matSuffix>email</mat-icon>
            </mat-form-field>
          </div>

          <div class="filter-group">
            <mat-form-field appearance="outline">
              <mat-label>Filter by Role</mat-label>
              <mat-select (selectionChange)="roleSearch($event)" placeholder="All Roles">
                <mat-option value="">All Roles</mat-option>
                <mat-option *ngFor="let role of roles" [value]="role">
                  {{ role | titlecase }}
                </mat-option>
              </mat-select>
              <mat-icon matSuffix>admin_panel_settings</mat-icon>
            </mat-form-field>
          </div>
        </div>
        <!--  *ngIf="filterActionsVisible$ | async" -->
        <div class="filter-actions-center">
          <button mat-raised-button color="primary" [disabled]="isFilterLoading" (click)="applyFilter()" class="apply-btn">
            <mat-spinner *ngIf="isFilterLoading" diameter="20"></mat-spinner>
            <mat-icon *ngIf="!isFilterLoading">filter_list</mat-icon>
            <span *ngIf="!isFilterLoading">Apply Filters</span>
          </button>
        </div>
      </ng-container>

      <!-- Mobile Filters -->
      <ng-template #mobileFilters>
        <div class="mobile-filters">
          <div class="mobile-search-row">
            <mat-form-field appearance="outline">
              <mat-label>Search by Name</mat-label>
              <input matInput placeholder="Search by name..." (input)="nameSearch($event)">
              <mat-icon matSuffix>person_search</mat-icon>
            </mat-form-field>
            
            <mat-form-field appearance="outline">
              <mat-label>Search by Email</mat-label>
              <input matInput placeholder="Search by email..." (input)="emailSearch($event)">
              <mat-icon matSuffix>email</mat-icon>
            </mat-form-field>
          </div>

          <div class="mobile-filter-buttons">
            <button mat-stroked-button [matMenuTriggerFor]="roleMenu" class="filter-menu-btn">
              <mat-icon>admin_panel_settings</mat-icon>
              <span>Role</span>
              <mat-icon>keyboard_arrow_down</mat-icon>
            </button>
            <mat-menu #roleMenu="matMenu">
              <mat-selection-list [multiple]="false" (selectionChange)="onRoleChange($event)">
                <mat-list-option [value]="" selected>All Roles</mat-list-option>
                <mat-list-option *ngFor="let role of roles" [value]="role">
                  {{ role | titlecase }}
                </mat-list-option>
              </mat-selection-list>
            </mat-menu>

            <button mat-raised-button color="primary" [disabled]="isFilterLoading" (click)="applyFilter()" class="mobile-apply-btn">
              <mat-spinner *ngIf="isFilterLoading" diameter="20"></mat-spinner>
              <mat-icon *ngIf="!isFilterLoading">filter_list</mat-icon>
              <span *ngIf="!isFilterLoading">Apply</span>
            </button>
          </div>
        </div>
      </ng-template>
    </div>
  </div>

  <!-- Users Table Section -->
  <div class="table-section">
    <div class="table-card">
      <div class="table-header">
        <div class="table-info">
          <h3 class="table-title">Users List</h3>
          <p class="table-subtitle">{{ dataSource.data.length }} users found</p>
        </div>

      </div>

      <div class="table-container mat-elevation-z2">
        <table mat-table matSort [dataSource]="dataSource" (matSortChange)="announceSortChange($event)" 
               class="users-table" >
          <!-- ID Column -->
          <ng-container matColumnDef="id">
            <th mat-header-cell *matHeaderCellDef mat-sort-header class="id-column">
              <div class="column-header">
                <mat-icon>tag</mat-icon>
                <span>ID</span>
              </div>
            </th>
            <td mat-cell *matCellDef="let element" class="id-cell">
              <span class="user-id">#{{ element.id }}</span>
            </td>
          </ng-container>

          <!-- Name Column -->
          <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef mat-sort-header class="name-column">
              <div class="column-header">
                <mat-icon>person</mat-icon>
                <span>Name</span>
              </div>
            </th>
            <td mat-cell *matCellDef="let element" class="name-cell">
              <div class="user-name">
                <h4>{{ element.name }}</h4>
              </div>
            </td>
          </ng-container>

          <!-- Email Column -->
          <ng-container matColumnDef="email">
            <th mat-header-cell *matHeaderCellDef mat-sort-header class="email-column">
              <div class="column-header">
                <mat-icon>email</mat-icon>
                <span>Email</span>
              </div>
            </th>
            <td mat-cell *matCellDef="let element" class="email-cell">
              <div class="email-info">
                <div class="email-address">{{ element.email }}</div>
              </div>
            </td>
          </ng-container>

          <!-- Role Column -->
          <ng-container matColumnDef="role">
            <th mat-header-cell *matHeaderCellDef mat-sort-header class="role-column">
              <div class="column-header">
                <mat-icon>admin_panel_settings</mat-icon>
                <span>Role</span>
              </div>
            </th>
            <td mat-cell *matCellDef="let element" class="role-cell">
              <div class="role-badge" [class.role-organizer]="element.role === 'organizer'" [class.role-participant]="element.role === 'participant'">
                <mat-icon>{{ element.role === 'organizer' ? 'admin_panel_settings' : 'person' }}</mat-icon>
                <span>{{ element.role | titlecase }}</span>
              </div>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true" class="table-header-row"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="table-row"></tr>
        </table>

        <!-- Loading State -->
        <div class="loading-overlay" *ngIf="loading">
          <mat-spinner diameter="50"></mat-spinner>
          <p>Loading users...</p>
        </div>

        <!-- Empty State -->
        <div class="empty-state" *ngIf="!loading && dataSource.data.length === 0">
          <mat-icon class="empty-icon">people_outline</mat-icon>
          <h3>No Users Found</h3>
          <p>No users match your current filters. Try adjusting your search criteria.</p>
          <button mat-raised-button color="primary" (click)="clearFilters()">
            <mat-icon>clear_all</mat-icon>
            Clear Filters
          </button>
        </div>

        <mat-paginator [pageSizeOptions]="[5, 10, 25, 50]" 
                      showFirstLastButtons 
                      aria-label="Select page of users"
                      class="users-paginator">
        </mat-paginator>
      </div>
    </div>
  </div>
</div>



